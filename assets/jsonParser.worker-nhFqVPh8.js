(function(){"use strict";function H(e,r=!1){const s=e.length;let n=0,t="",o=0,l=16,a=0,c=0,O=0,k=0,i=0;function p(u,y){let A=0,m=0;for(;A<u||!y;){let f=e.charCodeAt(n);if(f>=48&&f<=57)m=m*16+f-48;else if(f>=65&&f<=70)m=m*16+f-65+10;else if(f>=97&&f<=102)m=m*16+f-97+10;else break;n++,A++}return A<u&&(m=-1),m}function T(u){n=u,t="",o=0,l=16,i=0}function L(){let u=n;if(e.charCodeAt(n)===48)n++;else for(n++;n<e.length&&w(e.charCodeAt(n));)n++;if(n<e.length&&e.charCodeAt(n)===46)if(n++,n<e.length&&w(e.charCodeAt(n)))for(n++;n<e.length&&w(e.charCodeAt(n));)n++;else return i=3,e.substring(u,n);let y=n;if(n<e.length&&(e.charCodeAt(n)===69||e.charCodeAt(n)===101))if(n++,(n<e.length&&e.charCodeAt(n)===43||e.charCodeAt(n)===45)&&n++,n<e.length&&w(e.charCodeAt(n))){for(n++;n<e.length&&w(e.charCodeAt(n));)n++;y=n}else i=3;return e.substring(u,y)}function F(){let u="",y=n;for(;;){if(n>=s){u+=e.substring(y,n),i=2;break}const A=e.charCodeAt(n);if(A===34){u+=e.substring(y,n),n++;break}if(A===92){if(u+=e.substring(y,n),n++,n>=s){i=2;break}switch(e.charCodeAt(n++)){case 34:u+='"';break;case 92:u+="\\";break;case 47:u+="/";break;case 98:u+="\b";break;case 102:u+="\f";break;case 110:u+=`
`;break;case 114:u+="\r";break;case 116:u+="	";break;case 117:const f=p(4,!0);f>=0?u+=String.fromCharCode(f):i=4;break;default:i=5}y=n;continue}if(A>=0&&A<=31)if(S(A)){u+=e.substring(y,n),i=2;break}else i=6;n++}return u}function N(){if(t="",i=0,o=n,c=a,k=O,n>=s)return o=s,l=17;let u=e.charCodeAt(n);if(U(u)){do n++,t+=String.fromCharCode(u),u=e.charCodeAt(n);while(U(u));return l=15}if(S(u))return n++,t+=String.fromCharCode(u),u===13&&e.charCodeAt(n)===10&&(n++,t+=`
`),a++,O=n,l=14;switch(u){case 123:return n++,l=1;case 125:return n++,l=2;case 91:return n++,l=3;case 93:return n++,l=4;case 58:return n++,l=6;case 44:return n++,l=5;case 34:return n++,t=F(),l=10;case 47:const y=n-1;if(e.charCodeAt(n+1)===47){for(n+=2;n<s&&!S(e.charCodeAt(n));)n++;return t=e.substring(y,n),l=12}if(e.charCodeAt(n+1)===42){n+=2;const A=s-1;let m=!1;for(;n<A;){const f=e.charCodeAt(n);if(f===42&&e.charCodeAt(n+1)===47){n+=2,m=!0;break}n++,S(f)&&(f===13&&e.charCodeAt(n)===10&&n++,a++,O=n)}return m||(n++,i=1),t=e.substring(y,n),l=13}return t+=String.fromCharCode(u),n++,l=16;case 45:if(t+=String.fromCharCode(u),n++,n===s||!w(e.charCodeAt(n)))return l=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return t+=L(),l=11;default:for(;n<s&&h(u);)n++,u=e.charCodeAt(n);if(o!==n){switch(t=e.substring(o,n),t){case"true":return l=8;case"false":return l=9;case"null":return l=7}return l=16}return t+=String.fromCharCode(u),n++,l=16}}function h(u){if(U(u)||S(u))return!1;switch(u){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function J(){let u;do u=N();while(u>=12&&u<=15);return u}return{setPosition:T,getPosition:()=>n,scan:r?J:N,getToken:()=>l,getTokenValue:()=>t,getTokenOffset:()=>o,getTokenLength:()=>n-o,getTokenStartLine:()=>c,getTokenStartCharacter:()=>o-k,getTokenError:()=>i}}function U(e){return e===32||e===9}function S(e){return e===10||e===13}function w(e){return e>=48&&e<=57}var j;(function(e){e[e.lineFeed=10]="lineFeed",e[e.carriageReturn=13]="carriageReturn",e[e.space=32]="space",e[e._0=48]="_0",e[e._1=49]="_1",e[e._2=50]="_2",e[e._3=51]="_3",e[e._4=52]="_4",e[e._5=53]="_5",e[e._6=54]="_6",e[e._7=55]="_7",e[e._8=56]="_8",e[e._9=57]="_9",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.asterisk=42]="asterisk",e[e.backslash=92]="backslash",e[e.closeBrace=125]="closeBrace",e[e.closeBracket=93]="closeBracket",e[e.colon=58]="colon",e[e.comma=44]="comma",e[e.dot=46]="dot",e[e.doubleQuote=34]="doubleQuote",e[e.minus=45]="minus",e[e.openBrace=123]="openBrace",e[e.openBracket=91]="openBracket",e[e.plus=43]="plus",e[e.slash=47]="slash",e[e.formFeed=12]="formFeed",e[e.tab=9]="tab"})(j||(j={})),new Array(20).fill(0).map((e,r)=>" ".repeat(r));const _=200;new Array(_).fill(0).map((e,r)=>`
`+" ".repeat(r)),new Array(_).fill(0).map((e,r)=>"\r"+" ".repeat(r)),new Array(_).fill(0).map((e,r)=>`\r
`+" ".repeat(r)),new Array(_).fill(0).map((e,r)=>`
`+"	".repeat(r)),new Array(_).fill(0).map((e,r)=>"\r"+"	".repeat(r)),new Array(_).fill(0).map((e,r)=>`\r
`+"	".repeat(r));var v;(function(e){e.DEFAULT={allowTrailingComma:!1}})(v||(v={}));function G(e,r=[],s=v.DEFAULT){let n=null,t=[];const o=[];function l(c){Array.isArray(t)?t.push(c):n!==null&&(t[n]=c)}return X(e,{onObjectBegin:()=>{const c={};l(c),o.push(t),t=c,n=null},onObjectProperty:c=>{n=c},onObjectEnd:()=>{t=o.pop()},onArrayBegin:()=>{const c=[];l(c),o.push(t),t=c,n=null},onArrayEnd:()=>{t=o.pop()},onLiteralValue:l,onError:(c,O,k)=>{r.push({error:c,offset:O,length:k})}},s),t[0]}function X(e,r,s=v.DEFAULT){const n=H(e,!1),t=[];let o=0;function l(g){return g?()=>o===0&&g(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function a(g){return g?b=>o===0&&g(b,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function c(g){return g?b=>o===0&&g(b,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>t.slice()):()=>!0}function O(g){return g?()=>{o>0?o++:g(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>t.slice())===!1&&(o=1)}:()=>!0}function k(g){return g?()=>{o>0&&o--,o===0&&g(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:()=>!0}const i=O(r.onObjectBegin),p=c(r.onObjectProperty),T=k(r.onObjectEnd),L=O(r.onArrayBegin),F=k(r.onArrayEnd),N=c(r.onLiteralValue),h=a(r.onSeparator),J=l(r.onComment),u=a(r.onError),y=s&&s.disallowComments,A=s&&s.allowTrailingComma;function m(){for(;;){const g=n.scan();switch(n.getTokenError()){case 4:f(14);break;case 5:f(15);break;case 3:f(13);break;case 1:y||f(11);break;case 2:f(12);break;case 6:f(16);break}switch(g){case 12:case 13:y?f(10):J();break;case 16:f(1);break;case 15:case 14:break;default:return g}}}function f(g,b=[],Q=[]){if(u(g),b.length+Q.length>0){let E=n.getToken();for(;E!==17;){if(b.indexOf(E)!==-1){m();break}else if(Q.indexOf(E)!==-1)break;E=m()}}}function $(g){const b=n.getTokenValue();return g?N(b):(p(b),t.push(b)),m(),!0}function d(){switch(n.getToken()){case 11:const g=n.getTokenValue();let b=Number(g);isNaN(b)&&(f(2),b=0),N(b);break;case 7:N(null);break;case 8:N(!0);break;case 9:N(!1);break;default:return!1}return m(),!0}function K(){return n.getToken()!==10?(f(3,[],[2,5]),!1):($(!1),n.getToken()===6?(h(":"),m(),M()||f(4,[],[2,5])):f(5,[],[2,5]),t.pop(),!0)}function C(){i(),m();let g=!1;for(;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(g||f(4,[],[]),h(","),m(),n.getToken()===2&&A)break}else g&&f(6,[],[]);K()||f(4,[],[2,5]),g=!0}return T(),n.getToken()!==2?f(7,[2],[]):m(),!0}function ee(){L(),m();let g=!0,b=!1;for(;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(b||f(4,[],[]),h(","),m(),n.getToken()===4&&A)break}else b&&f(6,[],[]);g?(t.push(0),g=!1):t[t.length-1]++,M()||f(4,[],[4,5]),b=!0}return F(),g||t.pop(),n.getToken()!==4?f(8,[4],[]):m(),!0}function M(){switch(n.getToken()){case 3:return ee();case 1:return C();case 10:return $(!0);default:return d()}}return m(),n.getToken()===17?s.allowEmptyContent?!0:(f(4,[],[]),!1):M()?(n.getToken()!==17&&f(9,[],[]),!0):(f(4,[],[]),!1)}var V;(function(e){e[e.None=0]="None",e[e.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=2]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",e[e.InvalidUnicode=4]="InvalidUnicode",e[e.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",e[e.InvalidCharacter=6]="InvalidCharacter"})(V||(V={}));var I;(function(e){e[e.OpenBraceToken=1]="OpenBraceToken",e[e.CloseBraceToken=2]="CloseBraceToken",e[e.OpenBracketToken=3]="OpenBracketToken",e[e.CloseBracketToken=4]="CloseBracketToken",e[e.CommaToken=5]="CommaToken",e[e.ColonToken=6]="ColonToken",e[e.NullKeyword=7]="NullKeyword",e[e.TrueKeyword=8]="TrueKeyword",e[e.FalseKeyword=9]="FalseKeyword",e[e.StringLiteral=10]="StringLiteral",e[e.NumericLiteral=11]="NumericLiteral",e[e.LineCommentTrivia=12]="LineCommentTrivia",e[e.BlockCommentTrivia=13]="BlockCommentTrivia",e[e.LineBreakTrivia=14]="LineBreakTrivia",e[e.Trivia=15]="Trivia",e[e.Unknown=16]="Unknown",e[e.EOF=17]="EOF"})(I||(I={}));const q=G;var R;(function(e){e[e.InvalidSymbol=1]="InvalidSymbol",e[e.InvalidNumberFormat=2]="InvalidNumberFormat",e[e.PropertyNameExpected=3]="PropertyNameExpected",e[e.ValueExpected=4]="ValueExpected",e[e.ColonExpected=5]="ColonExpected",e[e.CommaExpected=6]="CommaExpected",e[e.CloseBraceExpected=7]="CloseBraceExpected",e[e.CloseBracketExpected=8]="CloseBracketExpected",e[e.EndOfFileExpected=9]="EndOfFileExpected",e[e.InvalidCommentToken=10]="InvalidCommentToken",e[e.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=12]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",e[e.InvalidUnicode=14]="InvalidUnicode",e[e.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",e[e.InvalidCharacter=16]="InvalidCharacter"})(R||(R={}));const z={indent:2,enableSingleQuoteFix:!0,enableTrailingCommaFix:!0,enableCommentRemoval:!0,enableSubstringExtraction:!0};function B(e,r=2){const s=new WeakSet;let n=0;const t=100;function o(l,a=0){if(l===null)return"null";if(l===void 0)return"undefined";if(typeof l=="boolean")return l.toString();if(typeof l=="number")return isFinite(l)?l.toString():"null";if(typeof l=="string")return JSON.stringify(l);if(typeof l=="object"){if(s.has(l))return'"[Circular Reference]"';s.add(l)}if(n>=t)return'"[Max Depth Reached]"';n++;try{if(Array.isArray(l)){if(l.length===0)return"[]";const p=" ".repeat(a+r),T=" ".repeat(a);return`[
${l.map(F=>`${p}${o(F,a+r)}`).join(`,
`)}
${T}]`}const c=" ".repeat(a+r),O=" ".repeat(a),k=Object.entries(l);return k.length===0?"{}":`{
${k.map(([p,T])=>{const L=JSON.stringify(p);return`${c}${L}: ${o(T,a+r)}`}).join(`,
`)}
${O}}`}finally{n--}}return o(e)}function W(e,r,s){return e.length>10485760?e:e.replace(r,s)}function Y(e,r={}){const s={...z,...r},n=[];let t=e;const o=e,a=new TextEncoder().encode(e).length>5*1024*1024;self.postMessage({type:"progress",progress:{step:1,total:8,message:"Attempting direct parse"}});try{const i=JSON.parse(t);return self.postMessage({type:"progress",progress:{step:1,total:8,message:"Formatting output"}}),{ok:!0,parsed:i,pretty:B(i,s.indent),repairs:n,confidence:"high",originalInput:o}}catch{}self.postMessage({type:"progress",progress:{step:2,total:8,message:"Trimming whitespace"}});const c=t.trim().replace(/^[\uFEFF\u200B-\u200D\uFFFE\uFFFF]/g,"");if(a){c.length!==t.length&&(n.push({type:"trim",chars:t.length-c.length}),t=c);try{const i=JSON.parse(t);return{ok:!0,parsed:i,pretty:B(i,s.indent),repairs:n,confidence:"high",originalInput:o}}catch{return{ok:!1,repairs:n,error:"Unable to parse large JSON. Please ensure it is valid JSON.",confidence:"low",originalInput:o}}}if(c.length!==t.length){n.push({type:"trim",chars:t.length-c.length}),t=c;try{const i=JSON.parse(t);return{ok:!0,parsed:i,pretty:B(i,s.indent),repairs:n,confidence:"high",originalInput:o}}catch{}}self.postMessage({type:"progress",progress:{step:3,total:8,message:"Removing leading garbage"}});const O=t.match(/[{\[]/);if(O&&O.index>0){const i=O.index;n.push({type:"removed_leading_garbage",chars:i}),t=t.substring(O.index);try{const p=JSON.parse(t);return{ok:!0,parsed:p,pretty:B(p,s.indent),repairs:n,confidence:"medium",originalInput:o}}catch{}}if(self.postMessage({type:"progress",progress:{step:4,total:8,message:"Extracting JSON substring"}}),s.enableSubstringExtraction){const i=D(t);if(i&&i!==t){n.push({type:"bracket_matching",original:t.length,extracted:i.length}),t=i;try{const p=JSON.parse(t);return{ok:!0,parsed:p,pretty:JSON.stringify(p,null,s.indent),repairs:n,confidence:"medium",originalInput:o}}catch{}}}if(self.postMessage({type:"progress",progress:{step:5,total:8,message:"Removing trailing commas"}}),s.enableTrailingCommaFix){const i=t.replace(/,(\s*[}\]])/g,"$1"),p=(t.match(/,(\s*[}\]])/g)||[]).length;if(p>0){n.push({type:"remove_trailing_commas",count:p}),t=i;try{const T=JSON.parse(t);return{ok:!0,parsed:T,pretty:JSON.stringify(T,null,s.indent),repairs:n,confidence:"medium",originalInput:o}}catch{}}}if(self.postMessage({type:"progress",progress:{step:6,total:8,message:"Fixing single quotes"}}),s.enableSingleQuoteFix){const i=Z(t),p=P(t,i);if(p>0){n.push({type:"single_quote_to_double",count:p}),t=i;try{const T=JSON.parse(t);return{ok:!0,parsed:T,pretty:JSON.stringify(T,null,s.indent),repairs:n,confidence:"medium",originalInput:o}}catch{}}}if(self.postMessage({type:"progress",progress:{step:7,total:8,message:"Trying JSONC parser"}}),s.enableCommentRemoval)try{const i=[],p=q(t,i,{allowTrailingComma:!0});if(i.length===0&&p!==void 0){const T=(t.match(/\/\/.*|\/\*[\s\S]*?\*\//g)||[]).length;return T>0&&n.push({type:"removed_comments",count:T}),{ok:!0,parsed:p,pretty:JSON.stringify(p,null,s.indent),repairs:n,confidence:"medium",originalInput:o}}}catch{}self.postMessage({type:"progress",progress:{step:8,total:8,message:"Handling multiple objects"}});const k=x(t);return k.length>1?{ok:!0,parsed:k,pretty:B(k,s.indent),repairs:[...n,{type:"substring",start:0,end:t.length}],confidence:"low",originalInput:o}:{ok:!1,repairs:n,error:"Unable to recover valid JSON from input",confidence:"low",originalInput:o}}function D(e){const s=Math.min(e.length,10485760),n=e.substring(0,s).search(/[{\[]/);if(n===-1)return null;const t=e[n],o=t==="{"?"}":"]";let l=0,a=!1,c=!1;const O=Math.min(e.length,n+10485760);for(let k=n;k<O;k++){const i=e[k];if(c){c=!1;continue}if(i==="\\"){c=!0;continue}if(i==='"'&&!a){a=!0;continue}if(i==='"'&&a){a=!1;continue}if(!a){if(i===t||t==="{"&&i==="["||t==="["&&i==="{")l++;else if((i===o||o==="}"&&i==="]"||o==="]"&&i==="}")&&(l--,l===0))return e.substring(n,k+1)}}return null}function Z(e){return W(e,/'([^'\\]*(\\.[^'\\]*)*)'/g,r=>'"'+r.slice(1,-1).replace(/"/g,'\\"')+'"')}function P(e,r){const s=(e.match(/'/g)||[]).length,n=(r.match(/'/g)||[]).length;return Math.floor((s-n)/2)}function x(e){const r=[];let s=e.trim();for(;s.length>0;)try{const n=s.search(/[{\[]/);if(n===-1)break;s=s.substring(n);const t=D(s);if(!t)break;const o=JSON.parse(t);r.push(o),s=s.substring(t.length).trim()}catch{break}return r}self.addEventListener("message",e=>{const{type:r,input:s,options:n}=e.data;if(r==="parse")try{const t=Y(s,n);self.postMessage({type:"result",result:t})}catch(t){self.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error"})}})})();
