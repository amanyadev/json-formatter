(function(){"use strict";function h(e,u=!1){const l=e.length;let n=0,t="",s=0,o=16,b=0,r=0,g=0,p=0,m=0;function F(i,T){let O=0,k=0;for(;O<i||!T;){let f=e.charCodeAt(n);if(f>=48&&f<=57)k=k*16+f-48;else if(f>=65&&f<=70)k=k*16+f-65+10;else if(f>=97&&f<=102)k=k*16+f-97+10;else break;n++,O++}return O<i&&(k=-1),k}function S(i){n=i,t="",s=0,o=16,m=0}function U(){let i=n;if(e.charCodeAt(n)===48)n++;else for(n++;n<e.length&&A(e.charCodeAt(n));)n++;if(n<e.length&&e.charCodeAt(n)===46)if(n++,n<e.length&&A(e.charCodeAt(n)))for(n++;n<e.length&&A(e.charCodeAt(n));)n++;else return m=3,e.substring(i,n);let T=n;if(n<e.length&&(e.charCodeAt(n)===69||e.charCodeAt(n)===101))if(n++,(n<e.length&&e.charCodeAt(n)===43||e.charCodeAt(n)===45)&&n++,n<e.length&&A(e.charCodeAt(n))){for(n++;n<e.length&&A(e.charCodeAt(n));)n++;T=n}else m=3;return e.substring(i,T)}function I(){let i="",T=n;for(;;){if(n>=l){i+=e.substring(T,n),m=2;break}const O=e.charCodeAt(n);if(O===34){i+=e.substring(T,n),n++;break}if(O===92){if(i+=e.substring(T,n),n++,n>=l){m=2;break}switch(e.charCodeAt(n++)){case 34:i+='"';break;case 92:i+="\\";break;case 47:i+="/";break;case 98:i+="\b";break;case 102:i+="\f";break;case 110:i+=`
`;break;case 114:i+="\r";break;case 116:i+="	";break;case 117:const f=F(4,!0);f>=0?i+=String.fromCharCode(f):m=4;break;default:m=5}T=n;continue}if(O>=0&&O<=31)if(y(O)){i+=e.substring(T,n),m=2;break}else m=6;n++}return i}function w(){if(t="",m=0,s=n,r=b,p=g,n>=l)return s=l,o=17;let i=e.charCodeAt(n);if(L(i)){do n++,t+=String.fromCharCode(i),i=e.charCodeAt(n);while(L(i));return o=15}if(y(i))return n++,t+=String.fromCharCode(i),i===13&&e.charCodeAt(n)===10&&(n++,t+=`
`),b++,g=n,o=14;switch(i){case 123:return n++,o=1;case 125:return n++,o=2;case 91:return n++,o=3;case 93:return n++,o=4;case 58:return n++,o=6;case 44:return n++,o=5;case 34:return n++,t=I(),o=10;case 47:const T=n-1;if(e.charCodeAt(n+1)===47){for(n+=2;n<l&&!y(e.charCodeAt(n));)n++;return t=e.substring(T,n),o=12}if(e.charCodeAt(n+1)===42){n+=2;const O=l-1;let k=!1;for(;n<O;){const f=e.charCodeAt(n);if(f===42&&e.charCodeAt(n+1)===47){n+=2,k=!0;break}n++,y(f)&&(f===13&&e.charCodeAt(n)===10&&n++,b++,g=n)}return k||(n++,m=1),t=e.substring(T,n),o=13}return t+=String.fromCharCode(i),n++,o=16;case 45:if(t+=String.fromCharCode(i),n++,n===l||!A(e.charCodeAt(n)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return t+=U(),o=11;default:for(;n<l&&v(i);)n++,i=e.charCodeAt(n);if(s!==n){switch(t=e.substring(s,n),t){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return t+=String.fromCharCode(i),n++,o=16}}function v(i){if(L(i)||y(i))return!1;switch(i){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function J(){let i;do i=w();while(i>=12&&i<=15);return i}return{setPosition:S,getPosition:()=>n,scan:u?J:w,getToken:()=>o,getTokenValue:()=>t,getTokenOffset:()=>s,getTokenLength:()=>n-s,getTokenStartLine:()=>r,getTokenStartCharacter:()=>s-p,getTokenError:()=>m}}function L(e){return e===32||e===9}function y(e){return e===10||e===13}function A(e){return e>=48&&e<=57}var V;(function(e){e[e.lineFeed=10]="lineFeed",e[e.carriageReturn=13]="carriageReturn",e[e.space=32]="space",e[e._0=48]="_0",e[e._1=49]="_1",e[e._2=50]="_2",e[e._3=51]="_3",e[e._4=52]="_4",e[e._5=53]="_5",e[e._6=54]="_6",e[e._7=55]="_7",e[e._8=56]="_8",e[e._9=57]="_9",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.asterisk=42]="asterisk",e[e.backslash=92]="backslash",e[e.closeBrace=125]="closeBrace",e[e.closeBracket=93]="closeBracket",e[e.colon=58]="colon",e[e.comma=44]="comma",e[e.dot=46]="dot",e[e.doubleQuote=34]="doubleQuote",e[e.minus=45]="minus",e[e.openBrace=123]="openBrace",e[e.openBracket=91]="openBracket",e[e.plus=43]="plus",e[e.slash=47]="slash",e[e.formFeed=12]="formFeed",e[e.tab=9]="tab"})(V||(V={})),new Array(20).fill(0).map((e,u)=>" ".repeat(u));const N=200;new Array(N).fill(0).map((e,u)=>`
`+" ".repeat(u)),new Array(N).fill(0).map((e,u)=>"\r"+" ".repeat(u)),new Array(N).fill(0).map((e,u)=>`\r
`+" ".repeat(u)),new Array(N).fill(0).map((e,u)=>`
`+"	".repeat(u)),new Array(N).fill(0).map((e,u)=>"\r"+"	".repeat(u)),new Array(N).fill(0).map((e,u)=>`\r
`+"	".repeat(u));var _;(function(e){e.DEFAULT={allowTrailingComma:!1}})(_||(_={}));function H(e,u=[],l=_.DEFAULT){let n=null,t=[];const s=[];function o(r){Array.isArray(t)?t.push(r):n!==null&&(t[n]=r)}return W(e,{onObjectBegin:()=>{const r={};o(r),s.push(t),t=r,n=null},onObjectProperty:r=>{n=r},onObjectEnd:()=>{t=s.pop()},onArrayBegin:()=>{const r=[];o(r),s.push(t),t=r,n=null},onArrayEnd:()=>{t=s.pop()},onLiteralValue:o,onError:(r,g,p)=>{u.push({error:r,offset:g,length:p})}},l),t[0]}function W(e,u,l=_.DEFAULT){const n=h(e,!1),t=[];let s=0;function o(c){return c?()=>s===0&&c(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function b(c){return c?a=>s===0&&c(a,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function r(c){return c?a=>s===0&&c(a,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>t.slice()):()=>!0}function g(c){return c?()=>{s>0?s++:c(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>t.slice())===!1&&(s=1)}:()=>!0}function p(c){return c?()=>{s>0&&s--,s===0&&c(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:()=>!0}const m=g(u.onObjectBegin),F=r(u.onObjectProperty),S=p(u.onObjectEnd),U=g(u.onArrayBegin),I=p(u.onArrayEnd),w=r(u.onLiteralValue),v=b(u.onSeparator),J=o(u.onComment),i=b(u.onError),T=l&&l.disallowComments,O=l&&l.allowTrailingComma;function k(){for(;;){const c=n.scan();switch(n.getTokenError()){case 4:f(14);break;case 5:f(15);break;case 3:f(13);break;case 1:T||f(11);break;case 2:f(12);break;case 6:f(16);break}switch(c){case 12:case 13:T?f(10):J();break;case 16:f(1);break;case 15:case 14:break;default:return c}}}function f(c,a=[],q=[]){if(i(c),a.length+q.length>0){let B=n.getToken();for(;B!==17;){if(a.indexOf(B)!==-1){k();break}else if(q.indexOf(B)!==-1)break;B=k()}}}function D(c){const a=n.getTokenValue();return c?w(a):(F(a),t.push(a)),k(),!0}function P(){switch(n.getToken()){case 11:const c=n.getTokenValue();let a=Number(c);isNaN(a)&&(f(2),a=0),w(a);break;case 7:w(null);break;case 8:w(!0);break;case 9:w(!1);break;default:return!1}return k(),!0}function x(){return n.getToken()!==10?(f(3,[],[2,5]),!1):(D(!1),n.getToken()===6?(v(":"),k(),E()||f(4,[],[2,5])):f(5,[],[2,5]),t.pop(),!0)}function K(){m(),k();let c=!1;for(;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(c||f(4,[],[]),v(","),k(),n.getToken()===2&&O)break}else c&&f(6,[],[]);x()||f(4,[],[2,5]),c=!0}return S(),n.getToken()!==2?f(7,[2],[]):k(),!0}function d(){U(),k();let c=!0,a=!1;for(;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(a||f(4,[],[]),v(","),k(),n.getToken()===4&&O)break}else a&&f(6,[],[]);c?(t.push(0),c=!1):t[t.length-1]++,E()||f(4,[],[4,5]),a=!0}return I(),c||t.pop(),n.getToken()!==4?f(8,[4],[]):k(),!0}function E(){switch(n.getToken()){case 3:return d();case 1:return K();case 10:return D(!0);default:return P()}}return k(),n.getToken()===17?l.allowEmptyContent?!0:(f(4,[],[]),!1):E()?(n.getToken()!==17&&f(9,[],[]),!0):(f(4,[],[]),!1)}var j;(function(e){e[e.None=0]="None",e[e.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=2]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",e[e.InvalidUnicode=4]="InvalidUnicode",e[e.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",e[e.InvalidCharacter=6]="InvalidCharacter"})(j||(j={}));var M;(function(e){e[e.OpenBraceToken=1]="OpenBraceToken",e[e.CloseBraceToken=2]="CloseBraceToken",e[e.OpenBracketToken=3]="OpenBracketToken",e[e.CloseBracketToken=4]="CloseBracketToken",e[e.CommaToken=5]="CommaToken",e[e.ColonToken=6]="ColonToken",e[e.NullKeyword=7]="NullKeyword",e[e.TrueKeyword=8]="TrueKeyword",e[e.FalseKeyword=9]="FalseKeyword",e[e.StringLiteral=10]="StringLiteral",e[e.NumericLiteral=11]="NumericLiteral",e[e.LineCommentTrivia=12]="LineCommentTrivia",e[e.BlockCommentTrivia=13]="BlockCommentTrivia",e[e.LineBreakTrivia=14]="LineBreakTrivia",e[e.Trivia=15]="Trivia",e[e.Unknown=16]="Unknown",e[e.EOF=17]="EOF"})(M||(M={}));const z=H;var R;(function(e){e[e.InvalidSymbol=1]="InvalidSymbol",e[e.InvalidNumberFormat=2]="InvalidNumberFormat",e[e.PropertyNameExpected=3]="PropertyNameExpected",e[e.ValueExpected=4]="ValueExpected",e[e.ColonExpected=5]="ColonExpected",e[e.CommaExpected=6]="CommaExpected",e[e.CloseBraceExpected=7]="CloseBraceExpected",e[e.CloseBracketExpected=8]="CloseBracketExpected",e[e.EndOfFileExpected=9]="EndOfFileExpected",e[e.InvalidCommentToken=10]="InvalidCommentToken",e[e.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=12]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",e[e.InvalidUnicode=14]="InvalidUnicode",e[e.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",e[e.InvalidCharacter=16]="InvalidCharacter"})(R||(R={}));const G={indent:2,enableSingleQuoteFix:!0,enableTrailingCommaFix:!0,enableCommentRemoval:!0,enableSubstringExtraction:!0};function X(e,u={}){const l={...G,...u},n=[];let t=e;const s=e;self.postMessage({type:"progress",progress:{step:1,total:8,message:"Attempting direct parse"}});try{const g=JSON.parse(t);return{ok:!0,parsed:g,pretty:JSON.stringify(g,null,l.indent),repairs:n,confidence:"high",originalInput:s}}catch{}self.postMessage({type:"progress",progress:{step:2,total:8,message:"Trimming whitespace"}});const o=t.trim().replace(/^[\uFEFF\u200B-\u200D\uFFFE\uFFFF]/g,"");if(o.length!==t.length){n.push({type:"trim",chars:t.length-o.length}),t=o;try{const g=JSON.parse(t);return{ok:!0,parsed:g,pretty:JSON.stringify(g,null,l.indent),repairs:n,confidence:"high",originalInput:s}}catch{}}self.postMessage({type:"progress",progress:{step:3,total:8,message:"Removing leading garbage"}});const b=t.match(/[{\[]/);if(b&&b.index>0){const g=b.index;n.push({type:"removed_leading_garbage",chars:g}),t=t.substring(b.index);try{const p=JSON.parse(t);return{ok:!0,parsed:p,pretty:JSON.stringify(p,null,l.indent),repairs:n,confidence:"medium",originalInput:s}}catch{}}if(self.postMessage({type:"progress",progress:{step:4,total:8,message:"Extracting JSON substring"}}),l.enableSubstringExtraction){const g=Q(t);if(g&&g!==t){n.push({type:"bracket_matching",original:t.length,extracted:g.length}),t=g;try{const p=JSON.parse(t);return{ok:!0,parsed:p,pretty:JSON.stringify(p,null,l.indent),repairs:n,confidence:"medium",originalInput:s}}catch{}}}if(self.postMessage({type:"progress",progress:{step:5,total:8,message:"Removing trailing commas"}}),l.enableTrailingCommaFix){const g=t.replace(/,(\s*[}\]])/g,"$1"),p=(t.match(/,(\s*[}\]])/g)||[]).length;if(p>0){n.push({type:"remove_trailing_commas",count:p}),t=g;try{const m=JSON.parse(t);return{ok:!0,parsed:m,pretty:JSON.stringify(m,null,l.indent),repairs:n,confidence:"medium",originalInput:s}}catch{}}}if(self.postMessage({type:"progress",progress:{step:6,total:8,message:"Fixing single quotes"}}),l.enableSingleQuoteFix){const g=Y(t),p=Z(t,g);if(p>0){n.push({type:"single_quote_to_double",count:p}),t=g;try{const m=JSON.parse(t);return{ok:!0,parsed:m,pretty:JSON.stringify(m,null,l.indent),repairs:n,confidence:"medium",originalInput:s}}catch{}}}if(self.postMessage({type:"progress",progress:{step:7,total:8,message:"Trying JSONC parser"}}),l.enableCommentRemoval)try{const g=[],p=z(t,g,{allowTrailingComma:!0});if(g.length===0&&p!==void 0){const m=(t.match(/\/\/.*|\/\*[\s\S]*?\*\//g)||[]).length;return m>0&&n.push({type:"removed_comments",count:m}),{ok:!0,parsed:p,pretty:JSON.stringify(p,null,l.indent),repairs:n,confidence:"medium",originalInput:s}}}catch{}self.postMessage({type:"progress",progress:{step:8,total:8,message:"Handling multiple objects"}});const r=$(t);return r.length>1?{ok:!0,parsed:r,pretty:JSON.stringify(r,null,l.indent),repairs:[...n,{type:"substring",start:0,end:t.length}],confidence:"low",originalInput:s}:{ok:!1,repairs:n,error:"Unable to recover valid JSON from input",confidence:"low",originalInput:s}}function Q(e){const u=e.search(/[{\[]/);if(u===-1)return null;const l=e[u],n=l==="{"?"}":"]";let t=0,s=!1,o=!1;for(let b=u;b<e.length;b++){const r=e[b];if(o){o=!1;continue}if(r==="\\"){o=!0;continue}if(r==='"'&&!s){s=!0;continue}if(r==='"'&&s){s=!1;continue}if(!s){if(r===l||l==="{"&&r==="["||l==="["&&r==="{")t++;else if((r===n||n==="}"&&r==="]"||n==="]"&&r==="}")&&(t--,t===0))return e.substring(u,b+1)}}return null}function Y(e){return e.replace(/'([^'\\]*(\\.[^'\\]*)*)'/g,u=>'"'+u.slice(1,-1).replace(/"/g,'\\"')+'"')}function Z(e,u){const l=(e.match(/'/g)||[]).length,n=(u.match(/'/g)||[]).length;return Math.floor((l-n)/2)}function $(e){const u=[];let l=e.trim();for(;l.length>0;)try{const n=l.search(/[{\[]/);if(n===-1)break;l=l.substring(n);const t=Q(l);if(!t)break;const s=JSON.parse(t);u.push(s),l=l.substring(t.length).trim()}catch{break}return u}self.addEventListener("message",e=>{const{type:u,input:l,options:n}=e.data;if(u==="parse")try{const t=X(l,n);self.postMessage({type:"result",result:t})}catch(t){self.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error"})}})})();
